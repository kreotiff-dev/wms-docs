# Архитектура системы

## Общий обзор

WMS система построена на основе современной REST API архитектуры с использованием Node.js, Express и MongoDB. Архитектура системы спроектирована для обеспечения масштабируемости, поддержки высокой нагрузки и простоты расширения.

## Архитектурная схема

```
┌───────────────┐       ┌───────────────┐       ┌───────────────┐
│   Клиентские  │       │               │       │   База данных │
│   приложения  ├──────►│  WMS API      ├──────►│   MongoDB     │
│               │       │               │       │               │
└───────────────┘       └───────┬───────┘       └───────────────┘
                                │
                                │
                        ┌───────▼───────┐
                        │  Интеграции   │
                        │  (ERP, CRM)   │
                        │               │
                        └───────────────┘
```

## Компоненты системы

### API слой (Backend)

API слой реализован на Node.js с использованием фреймворка Express и предоставляет RESTful интерфейс для взаимодействия с системой. Основные компоненты:

#### Маршрутизация (Routes)

Определяет все доступные API эндпоинты и связывает их с соответствующими контроллерами:

- **`/wms/v1/receiving`** - API для приемки товаров
- **`/wms/v1/locations`** - API для управления ячейками склада
- **`/wms/v1/placement-carts`** - API для тележек размещения
- **`/wms/v1/inventory`** - API для управления инвентарем
- **`/wms/v1/products`** - API для управления товарами
- **`/wms/v1/orders`** - API для управления заказами
- **`/wms/v1/picking`** - API для сборки заказов
- **`/wms/v1/picking-carts`** - API для тележек сборки
- **`/wms/v1/packing`** - API для упаковки заказов
- **`/wms/v1/shipping`** - API для отгрузки заказов

#### Контроллеры (Controllers)

Содержат бизнес-логику для обработки запросов:

- **`controllers/receiving.js`** - Приемка товаров
- **`controllers/inventory.js`** - Управление инвентарем
- **`controllers/locations.js`** - Управление ячейками
- **`controllers/placementCart.js`** - Тележки размещения
- **`controllers/products.js`** - Управление товарами
- **`controllers/orders.js`** - Управление заказами
- **`controllers/picking.js`** - Сборка заказов
- **`controllers/pickingCart.js`** - Тележки сборки
- **`controllers/packing.js`** - Упаковка заказов
- **`controllers/shipping.js`** - Отгрузка заказов

#### Модели данных (Models)

Определяют структуру данных и взаимодействие с базой данных:

- **`models/product.js`** - Модель товара
- **`models/location.js`** - Модель ячейки
- **`models/inventory.js`** - Модель инвентаря
- **`models/invoice.js`** - Модель накладной
- **`models/order.js`** - Модель заказа
- **`models/pickingTask.js`** - Модель задания на сборку
- **`models/pickingCart.js`** - Модель тележки сборки
- **`models/placementCart.js`** - Модель тележки размещения
- **`models/packingTask.js`** - Модель задания на упаковку
- **`models/shippingTask.js`** - Модель задания на отгрузку

### База данных

Система использует MongoDB в качестве основного хранилища данных, что обеспечивает:

- Гибкость схемы данных
- Высокую производительность для операций чтения и записи
- Масштабируемость
- Эффективное хранение документо-ориентированных данных

### Документация API

Система включает встроенную документацию API с использованием Swagger/OpenAPI:

- **`/api-docs/swagger`** - Swagger UI для интерактивной работы с API
- **`/api-docs`** - Redoc для просмотра документации
- **`/api-docs/swagger.json`** - JSON спецификация API

## Потоки данных

### Основные процессы

1. **Приемка товаров**:
   ```
   Создание накладной → Сканирование товаров → Подсчет → Размещение → Обновление инвентаря
   ```

2. **Обработка заказа**:
   ```
   Создание заказа → Резервирование → Создание задания на сборку → Сборка → Упаковка → Отгрузка
   ```

3. **Инвентаризация**:
   ```
   Создание корректировки → Обновление инвентаря → Обновление статуса ячеек
   ```

## Технические особенности

### Масштабируемость

- Безсостояниевая архитектура (stateless)
- Возможность горизонтального масштабирования
- Эффективное использование индексов MongoDB

### Расширяемость

- Модульная структура проекта
- Возможность добавления новых модулей без изменения существующих
- Единый стиль кодирования и структуры API

### Безопасность

- Валидация входных данных
- Проверка доступа к ресурсам
- Обработка ошибок и исключений

## Будущие улучшения

- Внедрение механизма кэширования
- Асинхронная обработка длительных операций
- Реализация событийной архитектуры (Event Sourcing)
- Интеграция с системами аналитики и отчетности