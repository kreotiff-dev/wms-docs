# Отгрузка

## Обзор процесса

Отгрузка — завершающий этап складской обработки заказов, в ходе которого упакованные заказы подготавливаются к транспортировке, передаются перевозчикам и отправляются клиентам. Правильно организованный процесс отгрузки обеспечивает своевременную доставку заказов, снижает риски повреждений и потерь при транспортировке, оптимизирует затраты на логистику и повышает удовлетворенность клиентов.

## Участники процесса

- **Специалист по отгрузке**: выполняет подготовку заказов к отгрузке и передачу перевозчикам
- **Логист**: планирует маршруты и выбирает оптимальные способы доставки
- **Система WMS**: управляет заданиями на отгрузку и контролирует процесс
- **Перевозчик**: осуществляет транспортировку заказов до клиентов
- **Супервизор**: контролирует качество отгрузки и решает проблемные ситуации

## Диаграмма процесса

```
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│   Создание      │     │   Начало        │     │   Группировка   │
│   задания на    ├────►│   задания       ├────►│   заказов       │
│   отгрузку      │     │                 │     │                 │
└─────────────────┘     └─────────────────┘     └────────┬────────┘
                                                         │
                                                         ▼
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│   Подготовка    │     │   Формирование  │     │   Получение     │
│   документов    ├────►│   партий        ├────►│   упакованных   │
│                 │     │                 │     │   заказов       │
└─────────────────┘     └─────────────────┘     └────────┬────────┘
                                                         │
                                                         ▼
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│   Завершение    │     │   Регистрация   │     │   Передача      │
│   задания       │◄────┤   отгрузки      │◄────┤   перевозчику   │
│                 │     │                 │     │                 │
└─────────────────┘     └─────────────────┘     └─────────────────┘
```

## Шаги процесса

### 1. Создание задания на отгрузку

**Описание**: Формирование задания для отгрузки заказа после его упаковки.

**Действия**:

- Автоматическое или ручное создание задания на отгрузку
- Назначение приоритета и исполнителя
- Выбор способа доставки и перевозчика

**API Endpoint**: `POST /wms/v1/shipping`

**Входные данные**:

```json
{
  "orderId": "60d21b4667d0d8992e610c88",
  "packingTaskId": "60d21b4667d0d8992e610c94",
  "carrier": "DHL",
  "shippingMethod": "express",
  "assignedTo": "emp-003"
}
```

**Выходные данные**: Созданное задание на отгрузку

**Статус задания после шага**: `created`

### 2. Начало задания

**Описание**: Специалист по отгрузке начинает выполнение задания.

**Действия**:

- Получение информации о задании
- Подтверждение начала отгрузки
- Фиксация времени начала

**API Endpoint**: `POST /wms/v1/shipping/{id}/start`

**Выходные данные**: Обновленное задание на отгрузку со статусом `in_progress` и заполненным полем `startedAt`

**Статус задания после шага**: `in_progress`

### 3. Группировка заказов

**Описание**: Объединение заказов по направлениям, перевозчикам или типам доставки для оптимизации процесса.

**Действия**:

- Анализ маршрутов доставки
- Группировка заказов по географическим зонам
- Объединение заказов для одного клиента

**Типы группировки**:

- **По направлениям**: группировка заказов, следующих в одном направлении
- **По перевозчикам**: группировка заказов, передаваемых одному перевозчику
- **По клиентам**: объединение нескольких заказов одного клиента
- **По срочности**: разделение на срочные и стандартные отправления

### 4. Получение упакованных заказов

**Описание**: Сбор упакованных заказов из зоны упаковки или хранения.

**Действия**:

- Идентификация заказов по штрихкодам или номерам
- Перемещение заказов в зону отгрузки
- Предварительный осмотр упаковки на наличие повреждений

**Проверки**:

- Соответствие штрихкодов и номеров заказов
- Целостность упаковки
- Наличие всех необходимых маркировок

### 5. Формирование партий

**Описание**: Объединение заказов в партии для отправки.

**Действия**:

- Размещение заказов на паллетах или в транспортных контейнерах
- Фиксация заказов для предотвращения смещения
- Маркировка партий для легкой идентификации

**Типы партий**:

- **Паллеты**: для крупных или множественных заказов
- **Мешки или контейнеры**: для мелких отправлений
- **Курьерские партии**: для срочных и небольших заказов

### 6. Подготовка документов

**Описание**: Формирование и печать всех необходимых документов для отправки.

**Действия**:

- Печать товарно-транспортных накладных
- Формирование манифестов
- Подготовка таможенных деклараций (для международных отправлений)
- Печать ярлыков и этикеток для идентификации партий

**Ключевые документы**:

- **Товарно-транспортная накладная**: содержит информацию о товарах и их стоимости
- **Манифест**: список всех заказов в партии
- **Транспортная этикетка**: содержит адрес доставки и другую важную информацию
- **Таможенная декларация**: для международных отправлений

### 7. Передача перевозчику

**Описание**: Физическая передача заказов представителю транспортной компании.

**Действия**:

- Вызов представителя перевозчика или подготовка к его прибытию
- Проверка полномочий представителя
- Передача заказов и сопроводительных документов
- Подписание акта приема-передачи

**Варианты передачи**:

- **Прибытие курьера**: для забора одного или нескольких заказов
- **Загрузка в транспортное средство**: для крупных партий
- **Передача в пункт приема**: доставка заказов в офис перевозчика

### 8. Регистрация отгрузки

**Описание**: Фиксация факта отгрузки заказов и получение трекинг-номеров.

**Действия**:

- Сканирование штрихкодов отгруженных заказов
- Регистрация трекинг-номеров в системе
- Фиксация времени и даты отгрузки
- Указание информации о перевозчике

**API Endpoint**: `POST /wms/v1/shipping/{id}/complete`

**Входные данные**:

```json
{
  "trackingNumber": "DHL1234567890",
  "shippingCost": 15.99
}
```

**Выходные данные**: Обновленное задание на отгрузку со статусом `completed`, трекинг-номером и заполненным полем `completedAt`

### 9. Завершение задания

**Описание**: Завершение задания на отгрузку и обновление статуса заказа.

**Действия**:

- Подтверждение завершения отгрузки в системе
- Обновление статуса заказа
- Инициирование процесса уведомления клиента
- Архивирование документов

**Статус задания после шага**: `completed`
**Статус заказа после шага**: `shipped`

## Способы доставки

### Курьерская доставка

**Описание**: Доставка заказов курьерскими службами непосредственно клиенту.

**Особенности**:

- Доставка "до двери"
- Высокая скорость для небольших расстояний
- Возможность отслеживания в реальном времени
- Гибкие временные интервалы

**Рекомендуется для**:

- Срочных заказов
- Ценных или хрупких товаров
- Доставки в труднодоступные места
- Обслуживания VIP-клиентов

### Почтовая доставка

**Описание**: Отправка заказов через почтовые службы.

**Особенности**:

- Широкий охват, включая удаленные районы
- Стандартизированные тарифы
- Возможность отправки наложенным платежом
- Длительные сроки доставки

**Рекомендуется для**:

- Недорогих товаров
- Несрочных заказов
- Доставки в удаленные населенные пункты
- Международных отправлений

### Транспортные компании

**Описание**: Доставка крупных заказов или партий через грузовые транспортные компании.

**Особенности**:

- Возможность перевозки крупногабаритных грузов
- Оптимизация затрат при больших объемах
- Возможность страхования грузов
- Необходимость координации с получателем

**Рекомендуется для**:

- Крупногабаритных товаров
- Оптовых заказов
- B2B-поставок
- Доставки на значительные расстояния

### Самовывоз

**Описание**: Клиент самостоятельно забирает заказ со склада или из пункта выдачи.

**Особенности**:

- Наименьшие затраты на доставку
- Возможность проверки товара при получении
- Гибкость по времени (в рамках часов работы пункта выдачи)
- Необходимость идентификации клиента

**Рекомендуется для**:

- Клиентов, предпочитающих личное получение
- Экономии на доставке
- Срочных заказов, когда клиент может забрать быстрее, чем доставка
- Точек выдачи заказов

## Интеграция с транспортными компаниями

### API-интеграция

**Описание**: Прямое подключение к API транспортных компаний для автоматизации процессов.

**Возможности**:

- Автоматическое создание отправлений
- Печать этикеток и документов
- Получение трекинг-номеров
- Отслеживание статуса доставки
- Расчет стоимости доставки

**Преимущества**:

- Сокращение ручного труда
- Минимизация ошибок
- Быстрое получение информации
- Возможность выбора оптимального способа доставки

### Передача данных через файлы

**Описание**: Обмен информацией с перевозчиками посредством структурированных файлов.

**Форматы файлов**:

- CSV
- XML
- JSON
- Excel-таблицы

**Особенности**:

- Пакетная обработка отправлений
- Возможность работы без онлайн-доступа
- Совместимость с устаревшими системами
- Необходимость синхронизации данных

### Личные кабинеты перевозчиков

**Описание**: Использование веб-интерфейсов транспортных компаний для управления отправлениями.

**Функции**:

- Создание отправлений
- Печать сопроводительных документов
- Вызов курьера
- Отслеживание статуса доставки
- Получение отчетов

**Особенности**:

- Не требует технической интеграции
- Простота использования
- Ограниченные возможности автоматизации
- Необходимость ручного ввода данных

## Отслеживание отправлений

### Внутреннее отслеживание

**Описание**: Отслеживание статуса отправлений внутри системы StorageFlow.

**Ключевые статусы**:

- `shipped`: Отправлен со склада
- `in_transit`: В пути к клиенту
- `out_for_delivery`: Передан курьеру для доставки
- `delivered`: Доставлен клиенту
- `returned`: Возвращен на склад
- `lost`: Потерян при доставке

**API Endpoint**: `GET /wms/v1/shipping/tracking/{id}`

**Выходные данные**: Информация о текущем статусе отправления и история изменений

### Интеграция с системами отслеживания перевозчиков

**Описание**: Получение информации о статусе доставки от транспортных компаний.

**Методы интеграции**:

- API-запросы к системам перевозчиков
- Получение уведомлений через вебхуки
- Регулярная синхронизация статусов через пакетные запросы

**Основные события доставки**:

- Принято перевозчиком
- Отправлено со склада перевозчика
- Прибыло в промежуточный пункт
- Выдано курьеру
- Доставлено получателю
- Не доставлено (причина)
- Возвращено

### Уведомления клиентов

**Описание**: Информирование клиентов о статусе доставки их заказов.

**Каналы уведомлений**:

- Email
- SMS
- Push-уведомления в мобильном приложении
- Мессенджеры

**Ключевые моменты для уведомлений**:

- Подтверждение отгрузки с указанием трекинг-номера
- Передача курьеру и ожидаемое время доставки
- Успешная доставка
- Проблемы с доставкой

## Обработка исключительных ситуаций

### Отмена заказа после подготовки к отгрузке

**Сценарий**: Клиент отменяет заказ, который уже подготовлен к отгрузке или находится в процессе отгрузки.

**Решение**:

1. Проверка возможности отмены (не передан ли заказ перевозчику)
2. Отмена задания на отгрузку
3. Возврат товаров на склад (при необходимости)
4. Уведомление клиента о статусе отмены

**API Endpoint**: `POST /wms/v1/shipping/{id}/cancel`

**Входные данные**:

```json
{
  "reason": "Отмена по запросу клиента",
  "returnToStock": true
}
```

**Выходные данные**: Обновленное задание на отгрузку со статусом `cancelled`

### Повреждение упаковки при подготовке к отгрузке

**Сценарий**: Обнаружено повреждение упаковки заказа при подготовке к отгрузке.

**Решение**:

1. Оценка степени повреждения
2. Решение о необходимости переупаковки
3. Возврат заказа на участок упаковки (при необходимости)
4. Корректировка сроков доставки (при необходимости)

**API для отправки на переупаковку**:

```bash
curl -X POST http://localhost:3000/wms/v1/packing \
  -H "Content-Type: application/json" \
  -d '{
    "orderId": "60d21b4667d0d8992e610c88",
    "repackaging": true,
    "reason": "Повреждение упаковки при отгрузке"
  }'
```

### Проблемы с документами

**Сценарий**: Обнаружены ошибки или недостающие документы при отгрузке.

**Решение**:

1. Идентификация проблемных документов
2. Исправление ошибок или подготовка недостающих документов
3. Повторная печать и проверка
4. Продолжение процесса отгрузки

**Типичные проблемы с документами**:

- Неправильно указанный адрес
- Отсутствие таможенной документации
- Ошибки в информации о товарах
- Несоответствие манифеста и фактических заказов

### Неявка перевозчика

**Сценарий**: Перевозчик не прибыл в указанное время для забора заказов.

**Решение**:

1. Связь с представителем перевозчика
2. Определение новых сроков забора заказов
3. Корректировка графика отгрузки
4. Уведомление клиентов о возможной задержке

## Метрики и KPI

### Основные показатели эффективности

1. **Скорость отгрузки**:

   - Среднее время от создания задания до фактической отгрузки
   - Целевое значение: < 2 часа
   - Формула: общее время отгрузки / количество отгруженных заказов

2. **Своевременность отгрузки**:

   - Процент заказов, отгруженных в запланированные сроки
   - Целевое значение: > 98%
   - Формула: (количество своевременно отгруженных заказов / общее количество отгруженных заказов) × 100%

3. **Точность отгрузки**:

   - Процент заказов, отгруженных без ошибок (по адресу, комплектации и т.д.)
   - Целевое значение: > 99.5%
   - Формула: (общее количество отгруженных заказов - количество заказов с ошибками) / общее количество отгруженных заказов × 100%

4. **Производительность**:
   - Количество отгруженных заказов в час на одного сотрудника
   - Целевое значение: зависит от типа заказов
   - Формула: количество отгруженных заказов / (количество сотрудников × рабочие часы)

### Дополнительные метрики

1. **Стоимость отгрузки**:

   - Средняя стоимость отгрузки одного заказа
   - Целевое значение: оптимизация в зависимости от стратегии компании

2. **Загруженность транспорта**:

   - Процент использования грузоподъемности или объема транспортных средств
   - Целевое значение: > 80%

3. **Время ожидания перевозчика**:
   - Среднее время ожидания представителей перевозчиков
   - Целевое значение: < 15 минут

### Отслеживание метрик

Система StorageFlow предоставляет следующие инструменты для отслеживания и анализа метрик процесса отгрузки:

1. **Дашборды в реальном времени**:

   - Отображение текущего статуса отгрузок
   - Трекинг KPI в реальном времени
   - Оповещения при выходе показателей за допустимые пределы

2. **Аналитические отчеты**:

   - Ежедневные, еженедельные и ежемесячные отчеты
   - Сравнительный анализ по периодам
   - Детализация причин отклонений

3. **Прогнозная аналитика**:
   - Прогнозирование загруженности отдела отгрузки
   - Планирование ресурсов на основе прогнозов
   - Выявление сезонных закономерностей

## Интеграция с другими процессами

### Связь с процессом упаковки

1. **Информационная связь**:

   - Автоматическое создание задания на отгрузку после завершения упаковки
   - Передача информации о весе, габаритах и типе упаковки
   - Уведомление об особых требованиях к транспортировке

2. **Физическая связь**:
   - Перемещение упакованных заказов из зоны упаковки в зону отгрузки
   - Передача сопроводительных документов
   - Обратная связь при обнаружении проблем с упаковкой

### Связь с управлением заказами

1. **Обновление статуса заказа**:

   - Изменение статуса заказа на "shipped" после отгрузки
   - Добавление информации о трекинг-номере и перевозчике
   - Расчет ожидаемой даты доставки

2. **Уведомления клиента**:
   - Инициирование уведомлений о статусе заказа
   - Предоставление информации для отслеживания
   - Обработка запросов клиента относительно статуса доставки

## Оптимизация процесса отгрузки

### Стратегии оптимизации

1. **Оптимизация маршрутов**:

   - Группировка заказов по направлениям
   - Выбор оптимальных маршрутов доставки
   - Минимизация общего расстояния и времени доставки

2. **Оптимизация загрузки транспорта**:

   - Максимальное использование грузоподъемности и объема
   - Оптимальное расположение заказов в транспорте
   - Учет особенностей заказов при загрузке (хрупкость, вес, габариты)

3. **Временные окна отгрузки**:
   - Распределение отгрузок по времени для избежания пиковых нагрузок
   - Согласование графиков с перевозчиками
   - Учет временных окон доставки клиентам

### Технологические улучшения

1. **Автоматизация**:

   - Автоматическая печать сопроводительных документов
   - Системы управления двором (Yard Management)
   - Использование мобильных терминалов для отслеживания процесса отгрузки

2. **Интеграция с перевозчиками**:

   - API-интеграция с системами перевозчиков
   - Автоматический обмен данными
   - Отслеживание транспорта в реальном времени

3. **Предиктивная аналитика**:
   - Прогнозирование объемов отгрузки
   - Планирование ресурсов на основе прогнозов
   - Оптимизация процессов на основе исторических данных

## Примеры использования API

### Создание задания на отгрузку

```bash
curl -X POST http://localhost:3000/wms/v1/shipping \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXCJ9..." \
  -d '{
    "orderId": "60d21b4667d0d8992e610c88",
    "packingTaskId": "60d21b4667d0d8992e610c94",
    "carrier": "DHL",
    "shippingMethod": "express",
    "assignedTo": "emp-003"
  }'
```

### Получение списка заданий на отгрузку

```bash
curl -X GET http://localhost:3000/wms/v1/shipping?status=in_progress \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXCJ9..."
```

### Начало отгрузки

```bash
curl -X POST http://localhost:3000/wms/v1/shipping/60d21b4667d0d8992e610c95/start \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXCJ9..."
```

### Завершение отгрузки

```bash
curl -X POST http://localhost:3000/wms/v1/shipping/60d21b4667d0d8992e610c95/complete \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXCJ9..." \
  -d '{
    "trackingNumber": "DHL1234567890",
    "shippingCost": 15.99
  }'
```

### Отмена отгрузки

```bash
curl -X POST http://localhost:3000/wms/v1/shipping/60d21b4667d0d8992e610c95/cancel \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXCJ9..." \
  -d '{
    "reason": "Отмена по запросу клиента"
  }'
```

## Рекомендации по повышению эффективности

### Организационные рекомендации

1. **Стандартизация процессов**:

   - Разработка и внедрение стандартных операционных процедур
   - Четкое распределение ролей и ответственности
   - Регулярный аудит соблюдения процессов

2. **Обучение персонала**:

   - Регулярные тренинги по работе с системой и оборудованием
   - Обучение эффективным методам отгрузки
   - Ознакомление с особенностями работы с различными перевозчиками

3. **Планирование ресурсов**:
   - Гибкий график работы с учетом пиковых нагрузок
   - Привлечение временного персонала в периоды высокого спроса
   - Оптимальное распределение задач между сотрудниками

### Технические рекомендации

1. **Оптимальная организация зоны отгрузки**:

   - Выделение отдельных зон для разных перевозчиков
   - Оборудование достаточного количества погрузочных доков
   - Обеспечение необходимого оборудования (сканеры, принтеры, средства погрузки)

2. **Интеграция с внешними системами**:

   - Прямая интеграция с системами перевозчиков
   - Синхронизация с системами отслеживания
   - Автоматизация обмена данными

3. **Использование мобильных технологий**:
   - Внедрение мобильных приложений для сотрудников отгрузки
   - Использование беспроводных сканеров и принтеров
   - Оперативный доступ к информации о заказах и отгрузках

## Заключение

Эффективная организация процесса отгрузки является важным фактором в обеспечении высокого уровня обслуживания клиентов и оптимизации логистических затрат. Правильно настроенный процесс отгрузки позволяет:

- Обеспечить своевременную доставку заказов клиентам
- Снизить риски повреждений и потерь при транспортировке
- Оптимизировать затраты на логистику
- Повысить прозрачность и отслеживаемость доставки
- Улучшить общее впечатление клиентов от сервиса

Система StorageFlow предоставляет все необходимые инструменты для организации, управления и оптимизации процесса отгрузки, обеспечивая полную интеграцию с другими складскими процессами и внешними системами перевозчиков.
