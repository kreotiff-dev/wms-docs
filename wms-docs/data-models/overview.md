# Обзор моделей данных

## Введение

Система управления складом (WMS) использует MongoDB в качестве NoSQL-базы данных, что обеспечивает гибкую схему данных и эффективную обработку документо-ориентированных данных. Модели данных разработаны с учетом специфики складских процессов и оптимизированы для обеспечения высокой производительности операций.

## ER-диаграмма

Ниже представлена упрощенная ER-диаграмма, отображающая основные сущности системы и их взаимосвязи:

```
┌───────────────┐      ┌────────────────┐      ┌────────────────┐
│   Product     │      │   Inventory    │      │    Location    │
├───────────────┤      ├────────────────┤      ├────────────────┤
│ _id           │◄─────┤ sku            │      │ _id            │◄─────┐
│ sku*          │      │ quantity       │      │ barcode*       │      │
│ productId     │      │ locationId     ├─────►│ zone           │      │
│ name          │      │ status         │      │ aisle          │      │
│ barcode       │      │ createdAt      │      │ rack           │      │
│ category      │      └────────────────┘      │ level          │      │
│ dimensions    │                              │ position       │      │
│ createdAt     │                              │ status         │      │
│ updatedAt     │                              │ capacity       │      │
└───────────────┘                              │ usedCapacity   │      │
        ▲                                      │ createdAt      │      │
        │                                      └────────────────┘      │
        │                                                              │
        │        ┌────────────────┐            ┌────────────────┐      │
        │        │     Order      │            │   PickingTask  │      │
        │        ├────────────────┤            ├────────────────┤      │
        │        │ _id            │◄───────────┤ orderIds       │      │
        │        │ orderNumber*   │            │ assignedTo     │      │
        │        │ externalOrderId│            │ status         │      │
        │        │ customer       │            │ items          ├──────┘
        └────────┤ status         │            │ startedAt      │
                 │ priority       │            │ completedAt    │
                 │ items          │            │ createdAt      │
                 │ createdAt      │            └──────┬─────────┘
                 │ updatedAt      │                   │
                 └────────────────┘                   │
                        ▲                             │
                        │                             │
                        │                             │
             ┌──────────┴─────────┐                   │
             │                    │                   │
             │                    │                   │
┌────────────▼───────┐ ┌──────────▼─────────┐ ┌──────▼─────────────┐
│   PackingTask      │ │   ShippingTask     │ │    PickingCart     │
├────────────────────┤ ├────────────────────┤ ├────────────────────┤
│ _id                │ │ _id                │ │ _id                │
│ orderId            │ │ orderId            │ │ barcode*           │
│ pickingTaskId      │ │ packingTaskId      │ │ status             │
│ pickingCartId      │ │ carrier            │ │ assignedTo         │
│ assignedTo         │ │ trackingNumber     │ │ pickingTaskId      │
│ status             │ │ assignedTo         │ │ items              │
│ packageInfo        │ │ status             │ │ createdAt          │
│ startedAt          │ │ shippingAddress    │ │ updatedAt          │
│ completedAt        │ │ startedAt          │ └────────────────────┘
│ createdAt          │ │ completedAt        │         ▲
└────────────────────┘ │ createdAt          │         │
                       └────────────────────┘         │
                                                      │
                                                      │
                       ┌────────────────┐    ┌────────┴───────────┐
                       │    Invoice     │    │   PlacementCart   │
                       ├────────────────┤    ├────────────────────┤
                       │ _id            │    │ _id                │
                       │ invoiceNumber* │    │ status             │
                       │ barcode        │    │ items              │
                       │ status         │    │ createdAt          │
                       │ items          │    └────────────────────┘
                       │ createdAt      │
                       └────────────────┘
```

## Основные модели данных

### Товары и инвентарь

1. **Product (Товар)** - Информация о товарах
   - Каталог товаров с описанием, характеристиками и категориями

2. **Inventory (Инвентарь)** - Фактические товарные запасы
   - Связывает товары с их физическим местоположением на складе
   - Хранит информацию о количестве товара в каждой ячейке

3. **Location (Ячейка)** - Складские ячейки
   - Физические места хранения товаров
   - Информация о зоне, проходе, стеллаже, уровне и позиции

### Приемка и размещение товаров

4. **Invoice (Накладная)** - Документы на приемку товаров
   - Список ожидаемых товаров и их количество
   - Отслеживание статуса приемки каждого товара

5. **PlacementCart (Тележка размещения)** - Тележки для размещения товаров
   - Используются при перемещении товаров от зоны приемки к местам хранения

### Обработка заказов

6. **Order (Заказ)** - Заказы клиентов
   - Список товаров для отправки
   - Информация о клиенте и статусе заказа

7. **PickingTask (Задание на сборку)** - Задания на сборку товаров
   - Объединяет несколько заказов для оптимизации сборки
   - Содержит список товаров для сборки с указанием их местоположения

8. **PickingCart (Тележка сборки)** - Тележки для сборки заказов
   - Используются при перемещении собранных товаров

9. **PackingTask (Задание на упаковку)** - Задания на упаковку заказов
   - Информация о упаковке собранных товаров
   - Связано с заказом и заданием на сборку

10. **ShippingTask (Задание на отгрузку)** - Задания на отгрузку
    - Информация об отправке упакованных заказов
    - Данные о перевозчике и номере отслеживания

## Связи между моделями

### Основные связи

- **Product ←→ Inventory**: Товары связаны с инвентарем через SKU
- **Inventory ←→ Location**: Инвентарь связан с ячейками через locationId
- **Order ←→ PickingTask**: Задания на сборку связаны с заказами через orderIds
- **PickingTask ←→ PickingCart**: Тележки сборки связаны с заданиями через pickingTaskId
- **Order ←→ PackingTask**: Задания на упаковку связаны с заказами через orderId
- **PackingTask ←→ ShippingTask**: Задания на отгрузку связаны с заданиями на упаковку через packingTaskId

### Дополнительные связи

- **Invoice.items ←→ PlacementCart.items**: Товары накладной могут быть связаны с тележкой размещения
- **Order.items ←→ Product**: Товары в заказе связаны с товарами в каталоге через SKU
- **PickingTask.items ←→ Location**: Элементы сборки связаны с ячейками через locationId

## Статусы объектов

Каждая модель имеет различные статусы, отражающие этапы жизненного цикла объекта. Например:

### Заказ (Order)
- `new`: Новый заказ
- `processing`: В обработке
- `picking`: На сборке
- `picked`: Собран
- `packing`: На упаковке
- `packed`: Упакован
- `shipping`: На отгрузке
- `shipped`: Отгружен
- `delivered`: Доставлен
- `cancelled`: Отменен

### Задание на сборку (PickingTask)
- `created`: Создано
- `assigned`: Назначено
- `in_progress`: В процессе
- `completed`: Завершено
- `cancelled`: Отменено

## Индексы и оптимизация

Для обеспечения высокой производительности системы используются следующие индексы:

- **Product**: Индексы по `sku` и `barcode`
- **Inventory**: Индексы по `sku` и `locationId`
- **Location**: Индекс по `barcode`
- **Order**: Индекс по `orderNumber`
- **Invoice**: Индекс по `invoiceNumber`

## Дополнительная информация

Каждая модель подробно описана в соответствующих разделах документации с указанием:
- Полной схемы данных
- Валидационных правил
- Примеров документов
- Взаимодействия с другими моделями